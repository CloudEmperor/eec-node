webpackJsonp([94],{ER87:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("oAV5"),a={name:"AddQuestionnaire",components:{},data:function(){return{pageTitle:"新建问卷",type:this.$route.query.type,status:this.$route.query.status,typeInput:"",times:[],isAuto:!1,isAutoTitle:"",genreOptions:[{name:"学生",id:"0"},{name:"教师",id:"1"}],classIds:[],off:!0,form:{formName:"",formId:void 0,startTime:"",endTime:"",type:"0",ext1:"",ext2:void 0,ext3:void 0,autoSend:void 0,ext4:void 0,classIds:void 0},rules:{formName:[{required:!0,message:"请输入问卷名称",trigger:"blur"}],type:[{required:!0,message:"请选择调查对象",trigger:"blur"}],ext1:[{required:!0,message:"请选择调查版本",trigger:"blur"}],ext2:[{required:!0,message:"请选择",trigger:"blur"}],ext3:[{required:!0,message:"请选择评价课程",trigger:"blur"}],classIds:[{required:!0,message:"请选择班级",trigger:"blur"}]},gradesArr:[],versionArr:[],courseArr:[],classList:[],courseName:"",classGradesOptions:[],api:{versionAll:function(e){return"/basic/version/all/"+e},classGrades:function(e){return"/basic/achieve/gradesbyVersionID/"+e},schedulingGrades:function(e){return"basic/scheduling/grades/"+e},scoreAnalysisGrades:function(e){return"/teacher/scoreAnalysis/grade/"+e.ext1+"/"+e.ext3},courseAll:function(e){return"/basic/course/formAll/"+e.specialtyId+"/"+e.versionId},formChooseClass:function(e){return"/form/rest/FormMainBaseBusiness/formChooseClass/v1"},addRequirementsMet:"/form/rest/FormMainBaseBusiness/addRequirementsMet/v1",editRequirementsMet:"/form/rest/FormMainBaseBusiness/modifyRequirementsMet/v1",info:"form/rest/FormMainBaseBusiness/displayRequirementsMet/v1",addCourseQuality:"/form/rest/FormMainBaseBusiness/addCourseQuality/v1",editCourseQuality:"/form/rest/FormMainBaseBusiness/modifyCourseQuality/v1",infoTwo:"/form/rest/FormMainBaseBusiness/displayCourseQuality/v1"}}},created:function(){this.off="课程负责人"===localStorage.getItem("roleName")},mounted:function(){this.initData()},methods:{initData:function(){this.version(),"graduate"===this.type?(this.typeInput="毕业要求达成评价",this.isAutoTitle="是否开启自动发送"):(this.typeInput="课程质量评价",this.isAutoTitle="开启老师发起评价提醒"),"edit"===this.status&&this.details()},details:function(){var e=this,t="graduate"===this.type?this.api.info:this.api.infoTwo,s="template"===this.$route.query.point?2:1,a={formId:this.$route.query.id,type:"graduate"===this.type?void 0:s};this.$post(t,a).then(function(t){if(200===t.code){var s=t.data[0]||{};e.form.formName=s.formName,e.form.ext1=s.ext1,e.form.ext2=s.ext2,e.form.formId=s.id,e.form.type=""+s.formType,e.form.startTime=Object(r.a)(s.startTime,"yyyy-MM-dd"),e.form.endTime=Object(r.a)(s.endTime,"yyyy-MM-dd"),e.times=[s.startTime,s.endTime],e.isAuto="0"!==s.ext5;var a=[];(s.sendClassids||[]).forEach(function(e){a.push(e.id)}),e.classIds=e.off?a:a.join(","),e.form.classIds=e.off?e.classIds.join(","):e.classIds,"graduate"===e.type&&e.classGrades(),"course"===e.type&&(e.form.ext3=s.ext3,e.changetype(),e.scoreAnalysisGrades(),e.getChooseClass())}})},timeChange:function(){this.form.startTime=Object(r.a)(Date.parse(this.times[0]),"yyyy-MM-dd"),this.form.endTime=Object(r.a)(Date.parse(this.times[1]),"yyyy-MM-dd")},create:function(e){var t=this;this.$refs[e].validate(function(e){e&&("add"===t.status?t.userAdd():"template"===t.$route.query.point?t.userAdd():t.userEdit())})},courseChange:function(e){var t=this;this.scoreAnalysisGrades(),this.courseArr.forEach(function(s){s.id!==e||(t.courseName=s.name)})},classChange:function(){"string"==typeof this.classIds?this.form.classIds=this.classIds:this.form.classIds=this.classIds.join(",")},userAdd:function(){var e=this;"graduate"===this.type?this.form.autoSend=this.isAuto?1:0:this.form.ext4=this.isAuto?1:0;var t="graduate"===this.type?this.api.addRequirementsMet:this.api.addCourseQuality;this.$post(t,this.form).then(function(t){200===t.code?e.$router.push({path:"/evaluationAndFeedback/editQuestionnaire",query:{id:t.data.formId,oldId:e.$route.query.id,entryType:e.type,courseName:e.courseName}}):e.$notify.error({title:"error",duration:1500,message:t.msg})})},userEdit:function(){var e=this;"graduate"===this.type?this.form.autoSend=this.isAuto?1:0:this.form.ext4=this.isAuto?1:0;var t="graduate"===this.type?this.api.editRequirementsMet:this.api.editCourseQuality;this.$post(t,this.form).then(function(t){200===t.code?e.$router.push({path:"/evaluationAndFeedback/editQuestionnaire",query:{id:e.form.formId,entryType:e.type,courseName:e.courseName}}):e.$notify.error({title:"error",duration:1500,message:t.msg})})},versionChange:function(){"graduate"===this.type&&this.classGrades(),"course"===this.type&&this.changetype()},schedulinggrades:function(){var e=this;this.$get(this.api.schedulingGrades(localStorage.getItem("specialId"))).then(function(t){e.gradesArr=t.data})},scoreAnalysisGrades:function(){var e=this,t=this.api.scoreAnalysisGrades({ext1:this.form.ext1,ext3:this.form.ext3});this.$get(t).then(function(t){e.gradesArr=t})},version:function(){var e=this;this.$get(this.api.versionAll(localStorage.getItem("specialId"))).then(function(t){e.versionArr=t.data})},classGrades:function(){var e=this;this.$get(this.api.classGrades(this.form.ext1)).then(function(t){e.classGradesOptions=t.data})},changetype:function(){var e=this,t={specialtyId:localStorage.getItem("specialtyId"),versionId:this.form.ext1};this.$get(this.api.courseAll(t)).then(function(t){e.courseArr=t.data})},getChooseClass:function(){var e=this,t={versionId:this.form.ext1,courseId:this.form.ext3,grade:this.form.ext2};this.$get(this.api.formChooseClass(),t).then(function(t){e.classList=t.data})}}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"center"},[s("div",{staticClass:"center_content"},[s("div",{staticClass:"center_content_title"},[s("SvgIcon",{attrs:{"icon-class":"icondatixitongguanli",size:"20px"}}),e._v(" "),s("span",[e._v(e._s(e.pageTitle))])],1),e._v(" "),s("div",{staticClass:"table-container add-questionnaire"},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[s("p",{staticClass:"small-title-tip"},[e._v("问卷基础信息")]),e._v(" "),s("el-form-item",{attrs:{label:"问卷类型"}},[s("el-input",{attrs:{disabled:""},model:{value:e.typeInput,callback:function(t){e.typeInput=t},expression:"typeInput"}})],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"问卷名称",prop:"formName"}},[s("el-input",{attrs:{placeholder:"请输入问卷名称"},model:{value:e.form.formName,callback:function(t){e.$set(e.form,"formName",t)},expression:"form.formName"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"调查对象",prop:"type"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.genreOptions,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"调查版本",prop:"ext1"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.versionChange},model:{value:e.form.ext1,callback:function(t){e.$set(e.form,"ext1",t)},expression:"form.ext1"}},e._l(e.versionArr,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),"graduate"===e.type?s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"调查年级",prop:"ext2"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.ext2,callback:function(t){e.$set(e.form,"ext2",t)},expression:"form.ext2"}},e._l(e.classGradesOptions,function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e(),e._v(" "),"course"===e.type?s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"评价课程",prop:"ext3"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.courseChange},model:{value:e.form.ext3,callback:function(t){e.$set(e.form,"ext3",t)},expression:"form.ext3"}},e._l(e.courseArr,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1):e._e()],1),e._v(" "),"course"===e.type?s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"发起学年",prop:"ext2"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.getChooseClass},model:{value:e.form.ext2,callback:function(t){e.$set(e.form,"ext2",t)},expression:"form.ext2"}},e._l(e.gradesArr,function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"选择班级",prop:"classIds"}},[s("el-select",{attrs:{multiple:e.off,placeholder:"请选择"},on:{change:e.classChange},model:{value:e.classIds,callback:function(t){e.classIds=t},expression:"classIds"}},e._l(e.classList,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1):e._e(),e._v(" "),s("el-row",[s("el-col",{attrs:{span:24}},[s("el-form-item",{staticClass:"first",attrs:{label:"调查时间",prop:""}},[s("el-date-picker",{attrs:{type:"daterange","range-separator":"-","start-placeholder":"设置开始时间","end-placeholder":"设置结束时间"},on:{change:e.timeChange},model:{value:e.times,callback:function(t){e.times=t},expression:"times"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:24}},[s("el-form-item",{staticClass:"start",attrs:{label:e.isAutoTitle}},[[s("el-checkbox",{model:{value:e.isAuto,callback:function(t){e.isAuto=t},expression:"isAuto"}})]],2)],1)],1)],1),e._v(" "),s("div",{staticClass:"add-questionnaire_footer"},[s("button",{staticClass:"el-button set-btn",attrs:{type:"button"},on:{click:function(t){return e.create("form")}}},[s("span",[e._v(e._s("add"===e.status?"创建问卷":"编辑问卷"))])])])],1)])])},staticRenderFns:[]};var o=s("C7Lr")(a,i,!1,function(e){s("e96E")},null,null);t.default=o.exports},e96E:function(e,t){}});
//# sourceMappingURL=94.2fcdb32d2a49873ecbdc.js.map