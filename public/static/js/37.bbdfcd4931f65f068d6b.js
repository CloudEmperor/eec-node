webpackJsonp([37],{It3p:function(t,e){},Xae7:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("3cXf"),o=n.n(a),i=n("brjS"),s=n("Z+s7"),r={name:"ContentItem",props:{data:{type:Object,default:function(){return{}}},indexVal:{type:Number,default:0}},data:function(){return{}},created:function(){},mounted:function(){},methods:{inputChange:function(){this.$emit("onChange",this.indexVal,this.data)},delItem:function(){this.$emit("onDelete",this.indexVal)}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content-item"},[n("el-input",{staticClass:"content-item_disable",attrs:{placeholder:""},on:{change:t.inputChange},model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}}),t._v(" "),n("el-input",{staticClass:"content-item_input",attrs:{placeholder:""},on:{change:t.inputChange},model:{value:t.data.content,callback:function(e){t.$set(t.data,"content",e)},expression:"data.content"}}),t._v(" "),n("label",{on:{click:function(e){return e.stopPropagation(),t.delItem(e)}}},[n("SvgIcon",{attrs:{"icon-class":"iconqudiao",size:"20px"}})],1)],1)},staticRenderFns:[]};var l=n("C7Lr")(r,c,!1,function(t){n("qAwB")},"data-v-0ac2cb84",null).exports,u={name:"TeachingGoal",components:{TitleCurmb:i.a,CourseSteps:s.a,ContentItem:l},data:function(){var t=this;return{claimOptions:[],courseName:this.$route.query.title,goals:[],goalsCopy:[],points:[],form:{goals:[],points:[]},rules:{goals:[{required:!0,validator:function(e,n,a){var o=0;0===t.goals.length&&a(new Error("请添加课程目标")),t.goals.forEach(function(t){""!==t.name&&""!==t.content||o++}),0===o?a():a(new Error("课程目标内容不能有空"))},trigger:"blur"}],points:[{required:!0,validator:function(e,n,a){var o=0;0===t.points.length&&a(new Error("请添加课程目标与毕业要求指标点的对应关系")),t.points.forEach(function(t){0!==t.goalChecked.length&&""!==t.claimId&&""!==t.pointId||o++}),0===o?a():a(new Error("课程目标与毕业要求指标点的对应关系内容不能有空"))},trigger:"blur"}]},api:{details:function(t){return"/basic/course/setTargetView/"+t},graduate:function(t){return"/basic/claim/listByVersionId/"+t},getId:function(){return"/basic/courseGoal/getId"},courseGoalDel:function(t){return"basic/courseGoal/del/"+t},claim:function(t){return"/basic/point/Claim/"+t},save:function(){return"/basic/course/setTarget"}}}},created:function(){},mounted:function(){this.initData(),this.getGraduate()},methods:{initData:function(){var t=this,e=this.api.details(this.$route.query.id);this.$get(e).then(function(e){if(1===e.status){var n=e.data.goals||[],a=e.data.points||[];n.forEach(function(e){e.changed=1,e.courseId=t.$route.query.id}),a.forEach(function(t,e){t.changed=1,t.goalChecked=[],t.goal.forEach(function(e){e.changed=1,t.goalChecked.push(e.courseGoalId)})}),t.goals=n,t.goalsCopy=JSON.parse(o()(n)),t.points=a}else t.$notify.error({title:"error",duration:1500,message:e.message})})},getGraduate:function(){var t=this,e=this.api.graduate(localStorage.getItem("versionId"));this.$get(e).then(function(e){1===e.status&&(t.claimOptions=e.data)})},deleteOptions:function(t){this.points.splice(t,1)},addObjective:function(){this.points.push({claimName:"",claimId:"",pointContent:"",pointId:"",goalChecked:[],goal:[],changed:0,pointOptions:[]})},claimChange:function(t,e){var n=this;this.$get(this.api.claim(t)).then(function(t){1===t.status&&(n.points[e].point="",n.points[e].pointOptions=t.data)})},addgoals:function(){var t=this;this.$get(this.api.getId()).then(function(e){var n={name:"课程目标",content:"",changed:0,courseId:t.$route.query.id,id:e};t.goals.push(n),t.goalsCopy.push(n)})},contentItemChange:function(t,e){var n=this.goals[t].id;this.goals[t]=e,this.goalsCopy.forEach(function(t){t.id===n&&(t.name=e.name,t.content=e.content)})},contentItemDel:function(t){var e=this,n=this.goals[t].id;this.goals.splice(t,1),this.goalsCopy.forEach(function(t,a){t.id===n&&(0===t.changed?e.goalsCopy.splice(a,1):t.changed=2)}),this.points.forEach(function(t){t.goalChecked.forEach(function(e,a){e===n&&t.goalChecked.splice(a,1)})})},formSubmit:function(t,e){var n=this;"save"===e?(this.$refs[t].resetFields(),this.userSave("save")):this.$refs[t].validate(function(t){t&&n.userSave("next")})},userSave:function(t){var e=this,n=[];this.points.forEach(function(t){t.goalChecked.forEach(function(e){n.push({indexPointId:t.pointId,courseGoalId:e})})});var a={courseGoals:this.goalsCopy,pointCourseGoals:n};this.$post(this.api.save(),a).then(function(n){1===n.status?(e.$notify.success({title:"success",duration:1500,message:n.message}),"next"===t?e.$router.push({path:"/Construction/basicRequirements",query:{id:e.$route.query.id,title:e.courseName}}):e.initData()):e.$notify.error({title:"error",duration:1500,message:n.message})})},unique:function(t){for(var e={},n=[],a=0;a<t.length;a++)e[t[a].id]||(e[t[a].id]=!0,n.push(t[a]));return n},rndNum:function(t){for(var e="",n=0;n<t;n++)e+=Math.floor(10*Math.random());return e}}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"course-construction"},[n("title-curmb"),t._v(" "),n("course-steps",{attrs:{title:t.courseName,step:2}}),t._v(" "),n("div",{staticClass:"course-construction_body"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"0"}},[n("h2",[t._v("课程目标")]),t._v(" "),n("el-row",[n("el-form-item",{attrs:{prop:"goals"}},t._l(t.goals,function(e,a){return n("content-item",{key:a,attrs:{data:e,indexVal:a},on:{onChange:t.contentItemChange,onDelete:t.contentItemDel}})}),1),t._v(" "),n("div",{staticClass:"add-step-title add-step-button",on:{click:t.addgoals}},[n("SvgIcon",{attrs:{"icon-class":"icontianjia",size:"20px"}}),t._v(" "),n("span",[t._v("添加课程目标")])],1)],1),t._v(" "),n("h2",[t._v("课程目标与毕业要求指标点的对应关系")]),t._v(" "),n("el-row",[n("el-form-item",{attrs:{prop:"points"}},[n("el-table",{staticClass:"cc-table",staticStyle:{width:"100%"},attrs:{data:t.points,border:""}},[n("el-table-column",{attrs:{label:"毕业要求"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.changed?n("div",[n("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择毕业要求"},on:{change:function(n){return t.claimChange(e.row.claimId,e.$index)}},model:{value:e.row.claimId,callback:function(n){t.$set(e.row,"claimId",n)},expression:"scope.row.claimId"}},t._l(t.claimOptions,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1):n("div",[t._v(t._s(e.row.claimName))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"毕业要求指标点"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.changed?n("div",[n("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择毕业要求指标点"},model:{value:e.row.pointId,callback:function(n){t.$set(e.row,"pointId",n)},expression:"scope.row.pointId"}},t._l(e.row.pointOptions,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1):n("div",[t._v(t._s(e.row.pointContent))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"课程目标"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-select",{staticClass:"my-input my-input_mg",attrs:{"value-key":"id",filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.row.goalChecked,callback:function(n){t.$set(e.row,"goalChecked",n)},expression:"scope.row.goalChecked"}},t._l(t.goals,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),0===e.row.changed?n("i",{staticClass:"el-icon-remove-outline",staticStyle:{"font-size":"21px",position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",cursor:"pointer",color:"#aaa","z-index":"10"},on:{click:function(n){return t.deleteOptions(e.$index)}}}):t._e()]}}])})],1),t._v(" "),n("div",{staticClass:"add-step-title add-step-button",on:{click:t.addObjective}},[n("SvgIcon",{attrs:{"icon-class":"icontianjia",size:"20px"}}),t._v(" "),n("span",[t._v("添加课程目标与毕业要求关系")])],1)],1)],1),t._v(" "),n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:6,offset:9}},[n("div",{staticClass:"c-footer"},[n("el-button",{on:{click:function(e){return t.formSubmit("form","save")}}},[t._v("保  存")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.formSubmit("form","next")}}},[t._v("下一步")])],1)])],1)],1)],1)],1)},staticRenderFns:[]};var p=n("C7Lr")(u,d,!1,function(t){n("It3p")},"data-v-1dfb411a",null);e.default=p.exports},qAwB:function(t,e){}});
//# sourceMappingURL=37.bbdfcd4931f65f068d6b.js.map