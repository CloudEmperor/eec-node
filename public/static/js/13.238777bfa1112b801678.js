webpackJsonp([13],{"8iiE":function(t,e){},YwoJ:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("3cXf"),i=n.n(a),r=n("HzJ8"),o=n.n(r),s=n("brjS"),c={name:"ExamContent",props:{data:{type:Object,default:function(){return{}}},indexVal:{type:Number,default:0}},data:function(){return{itemName:"分项考核:",contentName:"考查内容:"}},created:function(){},mounted:function(){},methods:{inputTitleChange:function(){this.$emit("onChange","title",this.indexVal,this.data.name,this.data.examContentnames)},inputContentChange:function(){this.$emit("onChange","content",this.indexVal,this.data.name,this.data.examContentnames)},delItem:function(){this.$emit("onDelete",this.indexVal)}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"exam-content"},[n("el-input",{staticClass:"exam-content_disable",attrs:{disabled:""},model:{value:t.itemName,callback:function(e){t.itemName=e},expression:"itemName"}}),t._v(" "),n("el-input",{staticClass:"exam-content_middle",attrs:{placeholder:""},on:{change:t.inputTitleChange},model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}}),t._v(" "),n("el-input",{staticClass:"exam-content_disable",attrs:{disabled:""},model:{value:t.contentName,callback:function(e){t.contentName=e},expression:"contentName"}}),t._v(" "),n("el-input",{staticClass:"exam-content_input",attrs:{placeholder:"考查知识点/题号，用逗号，隔开"},on:{change:t.inputContentChange},model:{value:t.data.examContentnames,callback:function(e){t.$set(t.data,"examContentnames",e)},expression:"data.examContentnames"}}),t._v(" "),n("label",{on:{click:function(e){return e.stopPropagation(),t.delItem(e)}}},[n("SvgIcon",{attrs:{"icon-class":"iconqudiao",size:"20px"}})],1)],1)},staticRenderFns:[]};var u=n("C7Lr")(c,l,!1,function(t){n("8iiE")},"data-v-2942097a",null).exports,d={name:"MySelect",props:{value:{type:String,default:""},options:{type:Array,default:function(){return[]}},parentIndex:{type:Number,default:0},childIndex:{type:Number,default:0}},data:function(){return{selectOptions:[],checked:""}},created:function(){},mounted:function(){this.checked=this.value,this.selectOptions=this.options},watch:{value:function(t){this.checked=t},options:function(t){this.selectOptions=t}},methods:{selectChange:function(){this.$emit("onChange",this.parentIndex,this.childIndex,this.checked)}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-select",{staticClass:"tail-end-input",attrs:{filterable:"",placeholder:"请选择对应的分项考核"},on:{change:t.selectChange},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}},t._l(t.selectOptions,function(t){return n("el-option",{key:t.examineId,attrs:{label:t.name,value:t.examineId,disabled:t.disabled}})}),1)},staticRenderFns:[]};var m=n("C7Lr")(d,h,!1,function(t){n("cYH3")},"data-v-ce442c06",null).exports,f={name:"ExamineDialog",props:{},data:function(){return{dialogFormVisible:!1,title:"",parentIndex:0,childIndex:0,checkAll:!1,isIndeterminate:!0,options:[],checkedItem:[],form:{}}},methods:{initData:function(t,e,n,a){this.title=n,this.parentIndex=t,this.childIndex=e;var i=a.checkArr.concat(a.showArr),r=this.nonrepeatingArray(i),o=[];a.defaultArr.forEach(function(t){r.forEach(function(e){t.name===e.name&&o.push(t)})}),this.options=o,this.checkedItem=a.checkArr.map(function(t){return t.name}),this.checkedItem.length&&this.checkedItem.length===this.options.length?(this.isIndeterminate=!1,this.checkAll=!0):this.checkedItem.length&&this.checkedItem.length<this.options.length?(this.isIndeterminate=!0,this.checkAll=!1):(this.isIndeterminate=!1,this.checkAll=!1),this.dialogFormVisible=!0},handleCheckAllChange:function(t){var e=[];this.options.forEach(function(t){e.push(t.name)}),this.checkedItem=t?e:[],this.isIndeterminate=!1},handlecheckedItemChange:function(t){var e=t.length;this.checkAll=e===this.options.length,this.isIndeterminate=e>0&&e<this.options.length},setCourseCancel:function(t){this.dialogFormVisible=!1},setCourseCreate:function(t){var e=[],n=JSON.parse(i()(this.options));this.checkedItem.forEach(function(t){n.forEach(function(n){t===n.name&&(n.disabled=!0,e.push(n))})});var a=n.reduce(function(t,e){return e.disabled||t.push(e),t},[]);this.$emit("success",this.parentIndex,this.childIndex,e,a),this.setCourseCancel("form")},nonrepeatingArray:function(t){var e={};return t.reduce(function(t,n){return e[n.name]||(e[n.name]=!0,t.push(n)),t},[])}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"examine-dialog"},[n("el-dialog",{attrs:{title:"选择考查内容",visible:t.dialogFormVisible,"before-close":t.setCourseCancel},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("p",[t._v("分项考核："+t._s(t.title))]),t._v(" "),n("el-form",{attrs:{model:t.form}},[n("el-form-item",{attrs:{label:"考查内容"}},[[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),n("div",{staticStyle:{margin:"15px 0"}}),t._v(" "),n("el-checkbox-group",{staticStyle:{"margin-left":"82px"},on:{change:t.handlecheckedItemChange},model:{value:t.checkedItem,callback:function(e){t.checkedItem=e},expression:"checkedItem"}},t._l(t.options,function(e,a){return n("el-checkbox",{key:a,attrs:{label:e.name}},[t._v(t._s(e.name))])}),1)]],2)],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){return t.setCourseCancel("form")}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.setCourseCreate("form")}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var b=n("C7Lr")(f,p,!1,function(t){n("le8A")},"data-v-02444f08",null).exports,v=function(){function t(t){var e,n={times:1,num:0};if(e=t,Math.floor(e)===e)return n.num=t,n;var a=t+"",i=a.indexOf("."),r=a.substr(i+1).length,o=Math.pow(10,r),s=parseInt(t*o+.5,10);return n.times=o,n.num=s,n}function e(e,n,a){var i=t(e),r=t(n),o=i.num,s=r.num,c=i.times,l=r.times,u=c>l?c:l;switch(a){case"add":return(c===l?o+s:c>l?o+s*(c/l):o*(l/c)+s)/u;case"subtract":return(c===l?o-s:c>l?o-s*(c/l):o*(l/c)-s)/u;case"multiply":return o*s/(c*l);case"divide":return o/s*(l/c)}}return{add:function(t,n){return e(t,n,"add")},subtract:function(t,n){return e(t,n,"subtract")},multiply:function(t,n){return e(t,n,"multiply")},divide:function(t,n){return e(t,n,"divide")}}}(),x={name:"ToconfigureHb",components:{TitleCurmb:s.a,ExamContent:u,MySelect:m,ExamineDialog:b},data:function(){var t=this;return{courseName:this.$route.query.name,courseId:this.$route.query.id||"",loadding:!1,patternOptions:[],initTableData:[],tableData:[],form:{patternOptions:[],tableData:[]},rules:{patternOptions:[{required:!0,validator:function(e,n,a){var i=0;0===t.patternOptions.length&&a(new Error("请添加分项考核及考查内容")),t.patternOptions.forEach(function(t){""!==t.name&&""!==t.examContentnames||i++}),0===i?a():a(new Error("分项考核及考查内容不能有空"))},trigger:"blur"}],tableData:[{required:!0,validator:function(e,n,a){0===t.tableData.length&&a(new Error("请添加课程目标的分项考核权重及考查内容"));var i=0,r=0,s=0;function c(t){var e=0,n=!0,i=!1,r=void 0;try{for(var s,c=o()(t);!(n=(s=c.next()).done);n=!0){var l=s.value.ratio||0;e=v.add(e,l)}}catch(t){i=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw r}}return 1===e?"next":a(new Error("每个课程目标下的权重总和必须等于1"))}t.tableData.forEach(function(t){0===t.table.length&&(s+=1),t.table.forEach(function(t){""===t.examineId&&(i+=1),0===t.checkArr.length&&(r+=1)})}),0!==s&&a(new Error("每个课程目标必须设置分项考核权重及考查内容")),0!==i&&a(new Error("每个课程目标下的分项考核不能为空")),0!==r&&a(new Error("每个课程目标下的考查内容不能为空"));for(var l=0,u=t.tableData.length;l<u;l++)if("next"===c(t.tableData[l].table)){if(!t.tableData[l+1]){a();break}c(t.tableData[l+1].table)}},trigger:"no"}]},api:{details:function(t){return"/basic/traExamContent/getexamine/"+t},getId:function(){return"/basic/courseGoal/getId"},save:function(){return"/basic/traExamContent/PattentContentBindGoal"}}}},created:function(){this.initData()},mounted:function(){},methods:{initData:function(){var t=this,e=this.api.details(this.courseId);this.$get(e).then(function(e){if(1===e.status){var n=e.data.patternList||[],a=e.data.patternGoalList||[],i=[],r=[];n.forEach(function(t){var e=[];t.names.split(",").forEach(function(t){t&&e.push({name:t})});var n={name:t.examine_name,examineId:t.examine_id,disabled:!1,examContentnames:t.names,examContentArr:e};i.push(n)}),a.forEach(function(t){var e={examGoalName:t.name,examGoalId:t.id,patternOptions:[],table:[]};t.examines.forEach(function(t){e.table.push({examineId:"",ratio:0,showArr:[],checkArr:[]})}),r.push(e)}),t.patternOptions=i,t.initTableData=r,t.initPatternGoalList(a)}else t.$notify.error({title:"error",duration:1500,message:e.message})})},initPatternGoalList:function(t){var e=[],n=JSON.parse(i()(this.patternOptions)),a={};t.forEach(function(t){var i={examGoalName:t.name,examGoalId:t.id,patternOptions:n,table:[]};a[""+t.id]=[],t.examines.forEach(function(e){var n=[];e.names.split(",").forEach(function(t){t&&n.push({name:t})}),a[""+t.id].push(e.examineId),i.table.push({examineId:e.examineId,ratio:+e.ratio,showArr:[],checkArr:n})}),e.push(i)});var r={};e.forEach(function(t){r[""+t.examGoalId]=[],t.patternOptions.forEach(function(e){if(a[""+t.examGoalId]){var n=JSON.parse(i()(e));a[""+t.examGoalId].forEach(function(t){n.examineId===t&&(n.disabled=!0)}),r[""+t.examGoalId].push(n)}})}),e.forEach(function(t){r[""+t.examGoalId]&&(t.patternOptions=r[""+t.examGoalId])}),e.forEach(function(t){t.table.forEach(function(t){n.forEach(function(e){t.examineId===e.examineId&&(t.defaultArr=e.examContentArr)})})}),this.tableData=e},addpatternOptions:function(){var t=this;this.$get(this.api.getId()).then(function(e){var n={name:"",examineId:e,disabled:!1,examContentnames:"",examContentArr:[]};t.patternOptions.push(n)})},contentItemChange:function(t,e,n,a){if(this.tableData=[],"title"===t)this.patternOptions[e].name=n;else{var i=a.replace(/，/g,",").split(",").filter(function(t,e,n){return n.indexOf(t)===e});this.patternOptions[e].examContentnames=i.join(",");var r=[];i.forEach(function(t,e){t&&r.push({name:t})}),this.patternOptions[e].examContentArr=r}},contentItemDel:function(t){this.patternOptions.splice(t,1),this.tableData=[]},saveCreate:function(t){var e=this;this.$refs[t].validateField("patternOptions",function(t){"请添加分项考核及考查内容"!==t&&"分项考核及考查内容不能有空"!==t&&(e.tableData=[],e.$nextTick(function(){var t=JSON.parse(i()(e.initTableData));t.forEach(function(t){t.patternOptions=JSON.parse(i()(e.patternOptions))}),e.tableData=t,e.$refs.formTable.clearValidate()}))})},mySelectChange:function(t,e,n){var a=this;this.tableData[t].table[e].examineId=n;var i=this.tableData[t].table.map(function(t){return t.examineId});this.tableData[t].patternOptions.forEach(function(t,e){t.disabled=!1}),this.tableData[t].patternOptions.forEach(function(r,o){r.examineId===n&&(a.tableData[t].table[e].defaultArr=r.examContentArr),i.forEach(function(e){r.examineId===e&&a.$set(a.tableData[t].patternOptions[o],"disabled",!0)})})},checkRow:function(t,e,n,a){var i=this;a.examineId&&(this.checkShowFn("open",a.examineId),setTimeout(function(){i.$refs.examineDialog.initData(t,e,n,a)},100))},dialogChange:function(t,e,n,a){this.tableData[t].table[e].checkArr=n;var i=this.tableData[t].table[e].examineId;this.tableData.forEach(function(t,e){t.table.forEach(function(t,e){t.examineId&&t.examineId===i&&(t.showArr=a)})})},addTableRow:function(t){this.tableData[t].table.push({examineId:"",ratio:0,showArr:[],checkArr:[]})},rowDel:function(t,e,n){var a=this,i=this.tableData[t].table[e].examineId;this.tableData[t].patternOptions.forEach(function(e,n){e.examineId===i&&a.$set(a.tableData[t].patternOptions[n],"disabled",!1)}),this.tableData[t].table[e].checkArr.length&&this.checkShowFn("del",i,this.tableData[t].table[e].checkArr),setTimeout(function(){a.tableData[t].table.splice(e,1),a.$set(a.tableData[t],"table",a.tableData[t].table)})},checkShowFn:function(t,e,n){if("open"===t){var a=[],i=0;this.tableData.forEach(function(t,n){t.table.forEach(function(t,n){t.examineId&&t.examineId===e&&t.checkArr.length&&(a=t.showArr,i=t.checkArr.length)})}),this.tableData.forEach(function(t,n){t.table.forEach(function(t,n){a.length&&t.examineId&&t.examineId===e?t.showArr=a:0===i&&0===a.length&&t.examineId&&t.examineId===e?t.showArr=t.defaultArr:0!==i&&t.defaultArr&&i===t.defaultArr.length&&t.examineId&&t.examineId===e&&(t.showArr=[])})})}else this.tableData.forEach(function(t,a){t.table.forEach(function(t,a){t.examineId&&t.examineId===e&&(t.showArr=t.showArr.concat(n))})})},formSubmit:function(t,e){var n=this;this.$refs[t].validate(function(t){if(t){var e=JSON.parse(i()(n.patternOptions)),a=JSON.parse(i()(n.tableData)),r=[];e.forEach(function(t){delete t.disabled,delete t.examContentArr}),a.forEach(function(t){t.table.forEach(function(e){var n=e.checkArr.map(function(t){return t.name});r.push({examGoalId:t.examGoalId,names:n.join(","),examineId:e.examineId,ratio:e.ratio})})});var o={courseId:n.courseId,patternList:e,patternGoalList:r};n.userSave(o)}})},userSave:function(t){var e=this;this.$post(this.api.save(),t).then(function(t){1===t.status?(e.$notify.success({title:"success",duration:1500,message:t.message}),setTimeout(function(){window.history.back(-1)},200)):e.$notify.error({title:"error",duration:1500,message:t.message})})}}},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"course-construction"},[n("title-curmb",{attrs:{parentMate:"试卷配置",mate:"配置考查内容与课程目标对应关系"}}),t._v(" "),n("div",{staticClass:"relation_title"},[t._v("《"+t._s(t.courseName)+"》课程试卷配置")]),t._v(" "),n("div",{staticClass:"course-construction_body"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"0"}},[n("h2",[t._v("分项考核及考查内容")]),t._v(" "),n("el-row",[n("el-form-item",{attrs:{prop:"patternOptions"}},t._l(t.patternOptions,function(e,a){return n("exam-content",{key:a,attrs:{data:e,indexVal:a},on:{onChange:t.contentItemChange,onDelete:t.contentItemDel}})}),1),t._v(" "),n("div",{staticClass:"add-step-title add-step-button",on:{click:t.addpatternOptions}},[n("SvgIcon",{attrs:{"icon-class":"icontianjia",size:"20px"}}),n("span",[t._v("新增考核方式")])],1),t._v(" "),n("div",{staticClass:"show-button",staticStyle:{width:"200px"},on:{click:function(e){return t.saveCreate("form")}}},[n("SvgIcon",{attrs:{"icon-class":"iconxiangxiajiantou",size:"12px"}}),t._v("\n                     保存数据并填入下表\n                ")],1)],1),t._v(" "),n("el-form-item",{ref:"formTable",attrs:{prop:"tableData"}},t._l(t.tableData,function(e,a){return n("el-row",{key:a},[n("h2",[t._v(t._s(e.examGoalName)+"：分项考核权重及考查内容")]),t._v(" "),n("el-table",{staticClass:"cc-table",staticStyle:{width:"100%"},attrs:{data:e.table,border:""}},[n("el-table-column",{attrs:{type:"index",label:"编号",align:"center",width:"50"}}),t._v(" "),n("el-table-column",{attrs:{label:"分项考核",width:"200"},scopedSlots:t._u([{key:"default",fn:function(i){return[n("my-select",{ref:"mySelect",refInFor:!0,attrs:{options:e.patternOptions,value:i.row.examineId,parentIndex:a,childIndex:i.$index},on:{onChange:t.mySelectChange}})]}}],null,!0)}),t._v(" "),n("el-table-column",{attrs:{label:"权重",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input-number",{attrs:{min:0,"controls-position":"right"},model:{value:e.row.ratio,callback:function(n){t.$set(e.row,"ratio",n)},expression:"scope.row.ratio"}})]}}],null,!0)}),t._v(" "),n("el-table-column",{attrs:{label:"考查内容"},scopedSlots:t._u([{key:"default",fn:function(i){return[n("div",{staticStyle:{width:"100%",height:"100%",display:"flex","justify-content":"center","align-items":"center"}},[i.row.checkArr.length?n("div",{staticStyle:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},[n("div",{staticStyle:{display:"flex"}},t._l(i.row.checkArr,function(e,a){return n("div",{key:a,staticStyle:{"margin-right":"10px"}},[n("span",{staticClass:"tick"}),n("span",{staticStyle:{display:"inline-block",transform:"translateY(-3px)"}},[t._v(t._s(e.name))])])}),0),t._v(" "),n("div",{staticClass:"operate-button distance"},[n("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(n){return n.preventDefault(),t.checkRow(a,i.$index,e.examGoalName,i.row)}}},[t._v("\n                                               重新选择 >\n                                               ")])],1)]):t._e(),t._v(" "),0===i.row.checkArr.length?n("div",{staticClass:"show-button",staticStyle:{width:"120px","margin-bottom":"0"},on:{click:function(n){return t.checkRow(a,i.$index,e.examGoalName,i.row)}}},[t._v("选择考查内容 >")]):t._e()])]}}],null,!0)}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("label",{staticClass:"tail-end_del",on:{click:function(n){return t.rowDel(a,e.$index,e.row)}}},[n("SvgIcon",{attrs:{"icon-class":"iconqudiao",size:"20px"}})],1)]}}],null,!0)})],1),t._v(" "),n("el-row",[e.table.length<t.patternOptions.length?n("div",{staticClass:"add-step-title add-step-button",on:{click:function(e){return t.addTableRow(a)}}},[n("SvgIcon",{attrs:{"icon-class":"icontianjia",size:"20px"}}),n("span",[t._v("添加分项考核")])],1):t._e(),t._v(" "),n("span",{staticClass:"tips"},[t._v("* 考核方式权重总和等于1")])])],1)}),1),t._v(" "),n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:6,offset:9}},[n("div",{staticClass:"c-footer"},[n("div",{staticClass:"submit--btn",on:{click:function(e){return t.formSubmit("form")}}},[t._v("提  交")])])])],1)],1)],1),t._v(" "),n("examine-dialog",{ref:"examineDialog",on:{success:t.dialogChange}})],1)},staticRenderFns:[]};var I=n("C7Lr")(x,g,!1,function(t){n("mgOi")},"data-v-4f047038",null);e.default=I.exports},cYH3:function(t,e){},le8A:function(t,e){},mgOi:function(t,e){}});
//# sourceMappingURL=13.238777bfa1112b801678.js.map